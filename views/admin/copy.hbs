
 <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<section>
  <div class="main-content">

    <div class="page-content">
      <div class="container">
        <div class="row">
         
          <div class="col-12 mt-150">
            <table class="table" id="myTable">
              {{!-- <thead>
                <tr>
                 <th class="align-middle" scope="col">NO.</th>
                <th class="align-middle" scope="col">Order-Id</th>
                <th class="align-middle" scope="col">Adress</th>
                <th class="align-middle" scope="col">Amountt</th>
                <th class="align-middle" scope="col">Status</th>
                <th class="align-middle" scope="col">Payment-method</th>
                <th class="align-middle" scope="col">Manage</th>
                </tr>
              </thead>
              <tbody> --}}
                {{!-- {{#each orders}}
                  <tr>
                    <td >{{this.date}}</td>
                    <td>{{this.deliveryDetails.Name}}</td>
                    <td>{{this.deliveryDetails.address}},<br>{{this.deliveryDetails.state}}<br>{{this.deliveryDetails.pincode}}</td> --}}
                    {{!-- <td>{{this.deliveryDetails.state}}</td> --}}
                    {{!-- <td>{{this.deliveryDetails.pincode}}</td> --}}
                    {{!-- <td>{{this.deliveryDetails.Email}}</td>
                    <td>{{this.deliveryDetails.Mobile}}</td>
                    <td>{{this.totalAmount}}</td>
                    <td>{{this.PaymentMethod}}</td>
                    <td>{{this.status}}</td>
                    <td>
                      
                      <a href="/view-order-products?id={{this._id}}" class="btn btn-success">Products</a>

                    </td>
                    <td>
                     <a
                        href="delete-orders/{{this._id}}"
                        class="btn btn-danger"
                        onclick="return confirm('Are you sure want to cancel {{this.Name}}?')"
                      >Cancel</a></div>

                </td>
                  </tr>
                {{/each}} --}}
                 {{!-- {{#each orders}}
              <tr>
                <td class="create_index">{{@index}}</td>
                <td class="align-middle">{{this._id}}</td>
                <td class="align-middle">
                  <h6>Adress:{{this.deliveryDetails.address}}</h6>
                  <h6>City:{{this.deliveryDetails.city}}</h6>
                  <h6>state:{{this.deliveryDetails.State}}</h6>
                  <h6>Pincode:{{this.deliveryDetails.pincode}}</h6>
                  <h6>Mobile:{{this.deliveryDetails.Mobile}}</h6>
                </td>
                <td class="align-middle">â‚¹ {{this.totalAmount}}</td>
                <td class="align-middle">{{this.status}}</td>
                <td class="align-middle">{{this.PaymentMethod}}</td>
                <td class="align-middle">
                  {{#if this.retured}}
                  <p class="text-success">*Chech order Status</p>
                  <select onchange="changeStatus('{{this._id}}')" name="orderstatus" id="{{this._id}}">
                    <option selected value="{{this.status}}">change Status</option>
                    <option value="Placed">Placed</option>
                    <option value="Shipped">Shipped</option>
                    <option value="On the Way">On the Way</option>
                    <option value="Delivered">Delivered</option>
                    <option value="Cancelled">Cancelled</option>
                  </select>
                  {{else}}
                  {{#if this.msg}}
                  {{#if this.cstCancel}}
                  <div class="width:10rem">
                    <p class="text-danger">Order canceld by customer before delivery</p>
                  </div>
                  {{else}}
                  {{#if this.CancelRefund}}
                  <p style="color: green;"> Cancel refund successfull</p>
                  {{else}}
                    <div class="width:2rem">
                    <h6 class="text-danger" style="width:10rem;">Product cancel by customer</h6>
                    <a style=""  class="login-trigger btn btn-dark" href="#" data-target="#login{{this._id}}" data-toggle="modal">Refund</a>
                    <div id="login{{this._id}}" class="modal fade" role="dialog">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-body">
                            <button data-dismiss="modal" class="close">&times;</button>
                            <h4>Refund</h4>
                            <form action="/admin/CancelRE" method="post">
                               <h4 style="color: red;"><span>Amount:{{this.totalAmount}} /- </span></h4>                              
                              <input type="number" name="Amount" class="password form-control" value="{{this.totalAmount}}" hidden/>
                               <input type="text" name="info" class="password form-control" value="canceled refund" hidden/>
                              <input type="text" name="userId" class="password form-control" value="{{this.userId}}" hidden />
                              <input type="text" name="orderid" class="password form-control" value="{{this._id}}" hidden />
                              <button class="btn btn-dark" type="submit">Refund</button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {{/if}}
                  {{/if}}
                  {{else}}
                  {{#if Returnrefund}}
                  <p style="color: green;">  Return refund successfull</p>
                  {{else}}
                  <div class="width:2rem">
                     <h6 class="text-info" style="width:10rem;">Product retured by customer</h6>
                     <a style="" class="login-trigger btn btn-dark" href="#" data-target="#log{{this._id}}" data-toggle="modal">Refund</a>
                     <div id="log{{this._id}}" class="modal fade" role="dialog">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-body">
                            <button data-dismiss="modal" class="close">&times;</button>
                            <h4>Refund</h4>
                            <form action="/admin/ReturnRe" method="post">
                               <h4 style="color: red;"><span>Amount:{{this.totalAmount}} /- </span></h4>                              
                               <input type="number" name="Amount" class="password form-control" value="{{this.totalAmount}}" hidden/>
                                <input type="text" name="info" class="password form-control" value="prodcut Returnd Refund" hidden/>
                              <input type="text" name="userId" this class="password form-control" value="{{this.userId}}" hidden />
                              <input type="text" name="orderid" class="password form-control" value="{{this._id}}" hidden />
                              <button class="btn btn-dark" type="submit">Refund</button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {{/if}}
                  {{/if}}
                  {{/if}}
                </td>
              </tr>
              {{/each}}
              </tbody> --}}
               <table  id="example" class="table  table-bordered" style="width:100%">
                            <thead>
                                <tr>
                                    <th style="text-align:center">#</th>
                                    <th style="text-align:center">Customer</th>
                                    <th style="text-align:center">Contact-No:</th>
                                    <th style="text-align:center">Payment Mode</th>
                                    <th style="text-align:center">Order Date</th>
                                    <th style="text-align:center">Status</th>
                                    <th style="text-align:center">Net Amount</th>
                                    <th style="text-align:center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each orders}}
                                <tr>
                                    <td style="text-align:center">{{inc @index}}</td>
                                    <td style="text-align:center">{{this.deliveryDetails.Name}}</td>
                                    <td style="text-align:center">{{this.deliveryDetails.Mobile}}</td>
                                    <td style="text-align:center">{{this.PaymentMethod}}</td>
                                    <td class="d-inline-block text-truncate" style="max-width: 150px;">{{this.date}}
                                    </td>


                                    <td style="text-align:center"><span id="{{this._id}}">{{this.status}}</span></td>


                                    <td style="text-align:center">{{this.totalAmount}}</td>


                                    <td>

                                          {{#isEqual this.status 'Cancelled'}}

                                        <div class="dropdown">
                                            {{!-- <button class="btn-sm  btn-secondary dropdown-toggle" type="button"
                                                id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false">
                                                Order Status
                                            </button> --}}
                                            <p>Cancelled</p>
                                            {{!-- <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                              
                                                <li><button type="button"
                                                        class="btn-sm btn-danger text-dark dropdown-item "
                                                        onclick="cancelOrderUser('{{this._id}}')">
                                                        Cancel</button>
                                                <li>
                                                <li><button type="button"
                                                        class="btn-sm btn-warning text-dark dropdown-item "
                                                        onclick="shipOrderUser('{{this._id}}')">
                                                        Shipped</button></li>
                                                <li> <button type="button"
                                                        class="btn-sm btn-success text-dark dropdown-item "
                                                        onclick="deliverOrderUser('{{this._id}}')">
                                                        Delivered</button></li>
                                            </ul> --}}
                                        </div>
                                          {{/isEqual}}
                                          {{#isEqual this.status 'Shipped'}}

                                        <div class="dropdown">
                                            <button class="btn-sm  btn-secondary dropdown-toggle" type="button"
                                                id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false">
                                                Order Status
                                            </button>
                                            
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                              
                                                <li><button type="button"
                                                        class="btn-sm btn-danger text-dark dropdown-item "
                                                        onclick="cancelOrderUser('{{this._id}}')">
                                                        Cancel</button>
                                                <li>
                                                
                                                <li> <button type="button"
                                                        class="btn-sm btn-success text-dark dropdown-item "
                                                        onclick="deliverOrderUser('{{this._id}}')">
                                                        Delivered</button></li>
                                            </ul>
                                        </div>
                                          {{/isEqual}}
                                    </td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>




<script>


function cancelOrderUser(proId) {
    event.preventDefault
    
   
    swal({
        title: "Order cancel",
        text: "Once cancel, the order get cancelled",
        icon: "info",
        buttons: true,
        dangerMode: true,
      })
      .then((willDelete) => {
        if (willDelete) {
            $.ajax({
                url: '/admin/order-canceladmins/' + proId,
                method: 'get',
                success: (response) => {
                   
                    if(response){
                        document.getElementById(proId).innerHTML = "Cancelled"
                        swal("Order Cancelled", "Sucessfully", "success",{
                            icon: "success",
                          });
                      
                        // location.reload()
                    
                    }
                       
        
                
                    
                    
                }
            })
        } else {
          swal("Your order  is safe");
        }
      })

}


function shipOrderUser(proId) {
    event.preventDefault
    
   
    swal({
        title: "Order Shipped",
        text: "Once shipped, the order get Shipped",
        icon: "info",
        buttons: true,
        dangerMode: true,
      })
      .then((willDelete) => {
        if (willDelete) {
            $.ajax({
                url: '/admin/order-shipped/' + proId,
                method: 'get',
                success: (response) => {
                   
                    if(response){
                        document.getElementById(proId).innerHTML = "Shipped"
                        swal("Order Shipped", "Sucessfully", "Success",{
                            icon: "success",
                          });
                        
                      
                        // location.reload()
                    
                    }
                       
        
                
                    
                    
                }
            })
        } else {
          swal("Your order is not Shipped");
        }
      })

}


function deliverOrderUser(proId) {
    event.preventDefault
    
   
    swal({
        title: "Order Delivered",
        text: "Once delivered, the order get Delivered",
        icon: "info",
        buttons: true,
        dangerMode: true,
      })
      .then((willDelete) => {
        if (willDelete) {
            $.ajax({
                url: '/admin/order-delivered/' + proId,
                method: 'get',
                success: (response) => {
                   
                    if(response){
                        document.getElementById(proId).innerHTML = "Delivered"
                        swal("Order Delivered", "Sucessfully", "Success",{
                            icon: "success",
                          });
                      
                        // location.reload()
                    
                    }
                       
        
                
                    
                    
                }
            })
        } else {
          swal("Your order is not Delivered");
        }
      })

}

</script>















<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
           
      
           
            
            <script
                src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
            <script
                src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap4.min.js"></script>






                <script defer src="https://cdn.crop.guide/loader/l.js?c=VVSZPT"></script>


                  <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
        <link rel="stylesheet"
            href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap4.min.css">
       

     <!-- cropper -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.js"></script>

<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>